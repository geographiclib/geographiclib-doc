<!DOCTYPE html>
<html>
  <head>
    <!-- $Id$ -->
    <title>Geodesic calculations</title>
    <meta name="description" content="Geodesic calculations" />
    <meta name="author" content="Charles F. F. Karney">
    <meta name="keywords"
	  content="geodesics,
		   geodesic distance,
		   geographic distance,
		   shortest path,
		   direct geodesic problem,
		   inverse geodesic problem,
		   distance and azimuth,
		   distance and heading,
		   range and bearing,
		   geographic area,
		   geodesic polygon,
		   spheroidal triangle,
		   latitude and longitude,
		   online calculator,
		   WGS84 ellipsoid,
		   GeographicLib" /> 
    <script type="text/javascript" src="GeographicLib/Math.js"></script>
    <script type="text/javascript" src="GeographicLib/Geodesic.js"></script>
    <script type="text/javascript" src="GeographicLib/GeodesicLine.js"></script>
    <script type="text/javascript" src="GeographicLib/PolygonArea.js"></script>
    <script type="text/javascript" src="GeographicLib/Interface.js"></script>
    <script type="text/javascript">
var geod = GeographicLib.Geodesic.WGS84;
function GeodesicInverse(input) {
  var result = {};
  try {
    // Input is a blank-delimited line: lat1 lon1 lat2 lon2
    var t = new String(input);
    t = t.split(/[\s,]+/,6);
    if (t[0] == "") t.shift();
    t = geod.Inverse
    (parseFloat(t[0]), parseFloat(t[1]), parseFloat(t[2]), parseFloat(t[3]));
    result.status = "OK";
    result.p1 =
      t.lat1.toFixed(13) + " " + t.lon1.toFixed(13) + " " + t.azi1.toFixed(13);
    result.p2 =
      t.lat2.toFixed(13) + " " + t.lon2.toFixed(13) + " " + t.azi2.toFixed(13);
    result.s12 =
      t.s12.toFixed(8);
  }
  catch (e) {
    result.status = "ERROR: " + e.message;
    result.p1 = "";
    result.p2 = "";
    result.s12 = "";
  }
  return result;
}

function GeodesicDirect(input) {
  var result = {};
  try {
    // Input is a blank-delimited line: lat1 lon1 azi1 s12
    var t = new String(input);
    t = t.split(/[\s,]+/,6);
    if (t[0] == "") t.shift();
    t = geod.Direct
    (parseFloat(t[0]), parseFloat(t[1]), parseFloat(t[2]), parseFloat(t[3]));
    result.status = "OK";
    result.p1 =
      t.lat1.toFixed(13) + " " + t.lon1.toFixed(13) + " " + t.azi1.toFixed(13);
    result.p2 =
      t.lat2.toFixed(13) + " " + t.lon2.toFixed(13) + " " + t.azi2.toFixed(13);
    result.s12 =
      t.s12.toFixed(8);
  }
  catch (e) {
    result.status = "ERROR: " + e.message;
    result.p1 = "";
    result.p2 = "";
    result.s12 = "";
  }
  return result;
}

function GeodesicPath(input) {
  var result = {};
  try {
    // Input is a blank-delimited line: lat1 lon1 lat2 lon2 ds12 maxnum
    var t = new String(input);
    t = t.split(/[\s,]+/,8);
    if (t[0] == "") t.shift();
    t = geod.Path
    (parseFloat(t[0]), parseFloat(t[1]), parseFloat(t[2]), parseFloat(t[3]),
     parseFloat(t[4]), parseInt(t[5]));
    result.status = "OK";
    result.points = ""
    for (var i = 0; i < t.length; ++i)
      result.points += t[i].lat.toFixed(13) + " " + t[i].lon.toFixed(13)
      + " " + t[i].azi.toFixed(13) + "\n";
  }
  catch (e) {
    result.status = "ERROR: " + e.message;
    result.points = "";
  }
  return result;
}

function GeodesicArea(input) {
  var result = {};
  try {
    // Input is a newline-delimited points;
    // each point is blank-delimited: lat lon
    var t = new String(input);
    t = t.split(/[\r\n]/);
    if (t[0] == "") t.shift();
    if (t[t.length-1] == "") t.pop();
    for (var i = 0; i < t.length; ++i) {
      var pos = t[i].split(/[\s,]+/,5);
      if (pos[0] == "") pos.shift();
      t[i] = {lat: parseFloat(pos[0]), lon: parseFloat(pos[1])};
    }
    t = geod.Area(t);
    result.status = "OK";
    result.area = t.number + " " +
      t.perimeter.toFixed(8) + " " + t.area.toFixed(3);
  }
  catch (e) {
    result.status = "ERROR: " + e.message;
    result.area = "";
  }
  return result;
}
    </script>
  </head>
  <body>
    <div>
      <h2>Geodesic calculations</h2>
    </div>
    <p>
      This page illustrates the geodesic routines available in
      <a href="http://geographiclib.sourceforge.net">GeographicLib</a>.
      The C++ code has been converted to javascript so the calculations
      are carried out on the client.  The algorithms are derived in
      <blockquote>
	Charles F. F. Karney,
	<a href="http://arxiv.org/abs/1102.1215">
	<i>Geodesics on an ellipsoid of revolution</i></a>,<br>
	Feb. 2011,
	<a href="http://arxiv.org/abs/1102.1215">arXiv:1102.1215</a>
	(<a href="http://arxiv.org/pdf/1102.1215">pdf</a>),
	<a href="http://geographiclib.sourceforge.net/geod-errata.html">
	  <b>errata</b></a>.
      </blockquote>
      This page just provides a basic interface.  There's no fancy
      parsing of geographic coordinates.  Enter latitudes and longitudes
      as signed decimal degrees using spaces or commas as separators.
      The number of digits given in the output roughly reflects the
      accuracy of the results.
    <p>
      Jump to:
      <ul>
	<li><a href="#inverse">Inverse problem</a></li>
	<li><a href="#direct">Direct problem</a></li>
	<li><a href="#path">Geodesic path</a></li>
	<li><a href="#area">Polygon area</a></li>
      </ul>
    </p>
    <hr>
    <form>
      <h3><a class="anchor" id="inverse">Inverse problem</h3>
      <p>
	Find the shortest path between two points on the earth.  The
	path is characterized by its length <i>s12</i> and its azimuth
	at the two ends <i>azi1</i> and <i>azi2</i>.  The sample
	calculation finds the shortest path between Wellington, New
	Zealand, and Salamanca, Spain.  (For this example, the
	<a href="http://www.ngs.noaa.gov/">NGS</a>
	<a href="http://www.ngs.noaa.gov/cgi-bin/Inv_Fwd/inverse2.prl">
        inverse geodesic calculator</a> returns a result which is 1.2 km
	too long with an azimuth which is off by 3 degrees.)
      </p>
      <p>Enter <i>&ldquo;lat1 lon1 lat2 lon2&rdquo;</i>
        (as signed decimal degrees):</p>
      <p>input: 
        <input name="input" size=72 value="-41.32 174.81 40.96 -5.50" />
      </p>
      <p>
        <input type="button" value="compute" 
	       onclick="var t = GeodesicInverse(input.value);
			statusa.value = t.status;
			p1.value = t.p1;
			p2.value = t.p2;
			s12.value = t.s12;" />
      </p>
      <p>
	status:
        <input name="statusa" size=50 readonly />
      </p>
      <p>
	lat1 lon1 azi1:
        <input name="p1" size=60 readonly />
      </p>
      <p>
	lat2 lon2 azi2:
        <input name="p2" size=60 readonly />
      </p>
      <p>
	s12:
        <input name="s12" size=20 readonly />
      </p>
    </form>
    <hr>
    <form>
      <h3><a class="anchor" id="direct">Direct problem</h3>
      <p>
	Find the destination traveling a given distance along a geodesic
	with a given azimuth at the starting point.  The destination is
	characterized by its position <i>lat2, lon2</i> and its azimuth
	at the destination <i>azi2</i>.  The sample calculation shows
	the result of travelling 10000 km NE from JFK airport.
      </p>
      <p>Enter <i>&ldquo;lat1 lon1 azi1 s12&rdquo;</i>
        (as signed decimal degrees and meters):</p>
      <p>input: 
        <input name="input" size=72 value="40.6 -73.8 45 10000e3" />
      </p>
      <p>
        <input type="button" value="compute" 
	       onclick="var t = GeodesicDirect(input.value);
			statusb.value = t.status;
			p1.value = t.p1;
			p2.value = t.p2;
			s12.value = t.s12;" />
      </p>
      <p>
	status:
        <input name="statusb" size=50 readonly />
      </p>
      <p>
	lat1 lon1 azi1:
        <input name="p1" size=60 readonly />
      </p>
      <p>
	lat2 lon2 azi2:
        <input name="p2" size=60 readonly />
      </p>
      <p>
	s12:
        <input name="s12" size=20 readonly />
      </p>
    </form>
    <hr>
    <form>
      <h3><a class="anchor" id="path">Geodesic path</h3>
      <p>
	Find intermediate points along a geodesic.  In addition to
	specifying the endpoints, give <i>ds12</i>, the maximum distance
	between the intermediate points and <i>maxk</i>, the maximum
	number of intervals the geodesic is broken into.  The output
	gives a sequence of positions <i>lat, lon</i> together with the
	corresponding azimuths <i>azi</i>.  The sample shows the path
	from JFK to Singapore's Changi Airport at about 1000 km
	intervals.  (In this example, the path taken by Google Earth
	deviates from the shortest path by about 2.9 km.)
      </p>
      <p>Enter <i>&ldquo;lat1 lon1 lat2 lon2 ds12 maxk&rdquo;</i>
        (as signed decimal degrees and meters):</p>
      <p>input: 
        <input name="input" size=72 value="40.6 -73.8 1.4 104 1000e3 20" />
      </p>
      <p>
        <input type="button" value="compute" 
	       onclick="var t = GeodesicPath(input.value);
			statusc.value = t.status;
			points.value = t.points;" />
      </p>
      <p>
	status:
        <input name="statusc" size=50 readonly />
      </p>
      <p>
	points (lat lon azi):<br>
        <textarea name="points" cols=60 rows=21 readonly></textarea>
      </p>
    </form>
    <hr>
    <form>
      <h3><a class="anchor" id="area">Polygon area</h3>
      <p>
	Compute the perimeter and area of a polygon whose sides are
	geodesics.  The polygon must be simple (i.e., must not intersect
	itself).  Counter-clockwise traversal of the polygon results in
	a positive area.  The polygon can encircle one or both poles.
	The sample gives the approximate perimeter (in m) and area (in
	m<sup>2</sup>) of Antarctica.  (For this example, Google Earth
	Pro returns an area which is 30 times too large!  However this
	is a little unfair, since Google Earth has no concept of
	polygons which encircle a pole.)
      </p>
      <p>Enter points, one per line, as <i>&ldquo;lat lon&rdquo;</i>
        (as signed decimal degrees):</p>
      <p>points (lat lon):<br>
        <textarea name="input" cols=36 rows=13>-63.1  -58
-72.9  -74
-71.9 -102
-74.9 -102
-74.3 -131
-77.5 -163
-77.4  163
-71.7  172
-65.9  140
-65.7  113
-66.6 	88
-66.9 	59
-69.8 	25
-70.0   -4
-71.0  -14
-77.3  -33
-77.9  -46
-74.7  -61
</textarea>
      </p>
      <p>
        <input type="button" value="compute" 
	       onclick="var t = GeodesicArea(input.value);
			statusd.value = t.status;
			area.value = t.area;" />
      </p>
      <p>
	status:
        <input name="statusd" size=50 readonly />
      </p>
      <p>
	number perimeter area:
        <input name="area" size=48 readonly />
      </p>
    </form>
    <hr>
    <address>Charles Karney
      <a href="mailto:charles@karney.com">&lt;charles@karney.com&gt;</a>
      (2011-07-14)</address>
    <br>
    <a href="http://sourceforge.net">
      <img src="http://sourceforge.net/sflogo.php?group_id=283628&amp;type=2"
	   border="0" alt="SourceForge.net" />
    </a>
  </body>
</html>
